var e=Object.prototype.toString;function t(t){return"[object Array]"===e.call(t)}var n={isArray:t,isObject:function(e){return null!==e&&"object"==typeof e},isDate:function(t){return"[object Date]"===e.call(t)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},forEach:function(e,n){if(null!=e)if("object"!=typeof e&&(e=[e]),t(e))for(var s=0,o=e.length;s<o;s++)n.call(null,e[s],s,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.call(null,e[r],r,e)}};function s(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var o=function(){const e=["post","get","put","delete","patch"],t=function(){};var o=function(e,t={}){const n=Object.keys(t);if(n.length)for(let s=0;s<n.length;s++)e.setRequestHeader(n[s],t[n[s]])},r=function(e,t,o){return"get"===e?function(e,t,o){if(!t)return e;var r;if(o)r=o(t);else if(n.isURLSearchParams(t))r=t.toString();else{var i=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),i.push(s(t)+"="+s(e))})))})),r=i.join("&")}if(r){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}(o,t=t.params?t.params:t):o},i=function(e,t,n){const{_evList:s,_config:o}=e;if(s.length)for(let e=0;e<s.length;e++)t.upload.addEventListener(s[e].evName,(t=>{s[e].callback(t.target)}));o.timeout&&t.addEventListener("timeout",(()=>{a(e,n),t.abort()}))},a=function(e,t){delete e._requestQueue[t]},c=function(e,t,n,s){const o=new XMLHttpRequest;return o.timeout=s&&s.timeout?s.timeout:e._config.timeout?e._config.timeout:"",s.withCredentials&&(o.withCredentials=s.withCredentials),e._requestQueue[t]?e._requestQueue[t].push(o):e._requestQueue[t]=[o],o},u=function(t){const n=t;for(let t=0;t<e.length;t++)l.prototype[e[t]]=(s,u={},l={})=>{let f=n._baseUrl+s,p=n._baseUrl+s;/^((https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/.test(s)&&(f=s,p=s);try{f+=JSON.stringify(u)}catch(e){console.log(e)}let h=n.getContext(f,"currInstance");h&&n._config.forbidRepeatRequest&&(h.abort(),a(n,f)),h=c(n,f,0,l),i(n,h,f);const g=r(e[t],u,p);h.open(e[t].toLocaleUpperCase(),g);let d={body:u,headers:Object.clone(n._headers)};var y;return n._onRequestYes&&(d=n._onRequestYes(d)||d),Object.assign(d.headers,l.headers||{}),(y=d.body)instanceof FormData&&"[object FormData]"===Object.prototype.toString.call(y)?delete d.headers["content-type"]:d.body=JSON.stringify(d.body),o(h,d.headers),h.send(d.body),new Promise((e=>{if("function"==typeof l.cancel)try{l.cancel((function(){h.abort(),e&&e({code:499,msg:"Client close request"}),e=null}))}catch(e){}h.onload=function(t){a(n,f);let{status:s,responseText:o={},statusText:r}=t.target;try{o=JSON.parse(o)}catch(e){}let i=null,c={data:o,response:{status:s,statusText:r},config:d};i=s>=400?n._onResponseNo(JSON.parse(JSON.stringify(c)))||o:n._onResponseYes(JSON.parse(JSON.stringify(c)))||o,delete i.response,e&&e(i),e=null}}))};return n};function l(e,t){return this instanceof l?(this._baseUrl=e,this._config=t?Object.assign({forbidRepeatRequest:!0},t):{forbidRepeatRequest:!0},this._requestQueue={},this._evList=[],this._headers=this._config.headers||{"content-type":"application/json; charset=utf-8"},u(this)):new l(...arguments)}return l.prototype.onRequest=function({yes:e=t,no:n=t}){return this._onRequestYes=e,this._onRequestNo=n,this},l.prototype.onResponse=function({yes:e=t,no:n=t}){return this._onResponseYes=e,this._onResponseNo=n,this},l.prototype.on=function(e,t){return this._evList.push({evName:e,callback:t}),this},l.prototype.getContext=function(e,t){const n=this;/^((https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/.test(e)||(e=this._baseUrl+e);const s={instances:n._requestQueue[e],currInstance:n._requestQueue[e]&&n._requestQueue[e].slice(-1)[0],abort(){let t=n._requestQueue[e];if(t){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);for(let e=0;e<t.length;e++)t[e]instanceof XMLHttpRequest&&t[e].abort()}}};return t?s[t]:s},l.prototype.constructor=l,l}();export default o;

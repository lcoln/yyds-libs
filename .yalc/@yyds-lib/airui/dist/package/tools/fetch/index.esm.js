var e=Object.prototype.toString;function t(t){return"[object Array]"===e.call(t)}var n={isArray:t,isObject:function(e){return null!==e&&"object"==typeof e},isDate:function(t){return"[object Date]"===e.call(t)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},forEach:function(e,n){if(null!=e)if("object"!=typeof e&&(e=[e]),t(e))for(var o=0,s=e.length;o<s;o++)n.call(null,e[o],o,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.call(null,e[r],r,e)}};function o(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var s=function(){const e=["post","get","put","delete","patch"],t=function(){};var s=function(e,t={}){const n=Object.keys(t);if(n.length)for(let o=0;o<n.length;o++)e.setRequestHeader(n[o],t[n[o]])},r=function(e,t,s){return"get"===e?function(e,t,s){if(!t)return e;var r;if(s)r=s(t);else if(n.isURLSearchParams(t))r=t.toString();else{var i=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),i.push(o(t)+"="+o(e))})))})),r=i.join("&")}if(r){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}(s,t=t.params?t.params:t):s},i=function(e,t,n){const{_evList:o,_config:s}=e;if(o.length)for(let e=0;e<o.length;e++)t.upload.addEventListener(o[e].evName,(t=>{o[e].callback(t.target)}));s.timeout&&t.addEventListener("timeout",(()=>{a(e,n),t.abort()}))},a=function(e,t){delete e._requestQueue[t]},c=function(e,t,n,o){const s=new XMLHttpRequest;return s.timeout=o&&o.timeout?o.timeout:e._config.timeout?e._config.timeout:"",e._requestQueue[t]?e._requestQueue[t].push(s):e._requestQueue[t]=[s],s},u=function(t){const n=t;for(let t=0;t<e.length;t++)l.prototype[e[t]]=(o,u={},l={})=>{let f=n._baseUrl+o,p=n._baseUrl+o;/^((https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/.test(o)&&(f=o,p=o);try{f+=JSON.stringify(u)}catch(e){console.log(e)}let h=n.getContext(f,"currInstance");h&&n._config.forbidRepeatRequest&&(h.abort(),a(n,f)),h=c(n,f,0,l),i(n,h,f);const g=r(e[t],u,p);h.open(e[t].toLocaleUpperCase(),g);let y={body:u,headers:Object.clone(n._headers)};var d;return n._onRequestYes&&(y=n._onRequestYes(y)||y),Object.assign(y.headers,l.headers||{}),(d=y.body)instanceof FormData&&"[object FormData]"===Object.prototype.toString.call(d)?delete y.headers["content-type"]:y.body=JSON.stringify(y.body),s(h,y.headers),h.send(y.body),new Promise((e=>{if("function"==typeof l.cancel)try{l.cancel((function(){h.abort(),e&&e({code:499,msg:"Client close request"}),e=null}))}catch(e){}h.onload=function(t){a(n,f);let{status:o,responseText:s={},statusText:r}=t.target;try{s=JSON.parse(s)}catch(e){}let i=null,c={data:s,response:{status:o,statusText:r},config:y};i=o>=400?n._onResponseNo(JSON.parse(JSON.stringify(c)))||s:n._onResponseYes(JSON.parse(JSON.stringify(c)))||s,delete i.response,e&&e(i),e=null}}))};return n};function l(e,t){return this instanceof l?(this._baseUrl=e,this._config=t?Object.assign({forbidRepeatRequest:!0},t):{forbidRepeatRequest:!0},this._requestQueue={},this._evList=[],this._headers=this._config.headers||{"content-type":"application/json; charset=utf-8"},u(this)):new l(...arguments)}return l.prototype.onRequest=function({yes:e=t,no:n=t}){return this._onRequestYes=e,this._onRequestNo=n,this},l.prototype.onResponse=function({yes:e=t,no:n=t}){return this._onResponseYes=e,this._onResponseNo=n,this},l.prototype.on=function(e,t){return this._evList.push({evName:e,callback:t}),this},l.prototype.getContext=function(e,t){const n=this;/^((https|http|ftp|rtsp|mms)?:\/\/)[^\s]+/.test(e)||(e=this._baseUrl+e);const o={instances:n._requestQueue[e],currInstance:n._requestQueue[e]&&n._requestQueue[e].slice(-1)[0],abort(){let t=n._requestQueue[e];if(t){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);for(let e=0;e<t.length;e++)t[e]instanceof XMLHttpRequest&&t[e].abort()}}};return t?o[t]:o},l.prototype.constructor=l,l}();export default s;
